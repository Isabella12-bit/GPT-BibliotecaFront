<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Biblioteca - Gestión de Recursos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Frontend - Biblioteca</h1>
  <!-- <p class="muted">Este single-file HTML permite crear, consultar, actualizar y eliminar <strong>libro</strong>, <strong>pelicula</strong> y <strong>laptop</strong> usando la API REST descrita en tu backend.</p> -->

  <div class="card">
    <h2>Crear producto</h2>
    <label>Tipo</label>
    <select id="create-tipo">
      <option value="libro">Libro</option>
      <option value="pelicula">Pelicula</option>
      <option value="laptop">Laptop</option>
    </select>

    <div id="create-fields"></div>
    <button id="btn-create">Crear</button>
  </div>

  <div class="row">
    <div class="col card">
      <h2>Buscar por ID</h2>
      <label>ID</label>
      <input id="get-id" placeholder="id del producto (Mongo ObjectId)" />
      <label>Tipo</label>
      <select id="get-tipo">
        <option value="libro">Libro</option>
        <option value="pelicula">Pelicula</option>
        <option value="laptop">Laptop</option>
      </select>
      <button id="btn-get">Buscar</button>
      <pre id="get-result">-</pre>
    </div>

    <div class="col card">
      <h2>Actualizar producto</h2>
      <label>ID</label>
      <input id="update-id" placeholder="id del producto" />
      <label>Tipo</label>
      <select id="update-tipo">
        <option value="libro">Libro</option>
        <option value="pelicula">Pelicula</option>
        <option value="laptop">Laptop</option>
      </select>
      <div id="update-fields"></div>
      <button id="btn-update">Actualizar</button>
      <pre id="update-result">-</pre>
    </div>
  </div>

  <div class="card">
    <h2>Eliminar producto</h2>
    <div class="row">
      <div class="col">
        <label>ID</label>
        <input id="delete-id" placeholder="id del producto" />
      </div>
      <div class="col">
        <label>Tipo</label>
        <select id="delete-tipo">
          <option value="libro">Libro</option>
          <option value="pelicula">Pelicula</option>
          <option value="laptop">Laptop</option>
        </select>
      </div>
    </div>
    <button id="btn-delete">Eliminar</button>
    <pre id="delete-result">-</pre>
  </div>

  <hr />
  <!-- <p class="muted">Notas: Cambia <code>BASE_URL</code> si tu servidor corre en otra ruta o puerto. El backend debe permitir CORS para que esto funcione desde un navegador.</p> -->

  <script>
    const BASE_URL = window.location.origin;
    const schema = {
      libro: [
        { name: 'titulo', label: 'Titulo', type: 'text' },
        { name: 'autor', label: 'Autor', type: 'text' },
        { name: 'isb', label: 'ISBN', type: 'text' },
        { name: 'paginas', label: 'Paginas', type: 'number' }
      ],
      pelicula: [
        { name: 'titulo', label: 'Titulo', type: 'text' },
        { name: 'director', label: 'Director', type: 'text' },
        { name: 'duracion', label: 'Duracion', type: 'text', placeholder: 'p.ej. 120 min' }
      ],
      laptop: [
        { name: 'modelo', label: 'Modelo', type: 'text' },
        { name: 'cpu', label: 'CPU', type: 'text' },
        { name: 'ram', label: 'RAM', type: 'text', placeholder: 'p.ej. 16GB' }
      ]
    };

    function buildFields(container, tipo, prefix = '') {
      container.innerHTML = '';
      const list = schema[tipo] || [];
      list.forEach(field => {
        const label = document.createElement('label');
        label.textContent = field.label;
        const input = document.createElement('input');
        input.name = prefix + field.name;
        input.id = prefix + field.name;
        input.type = field.type || 'text';
        if (field.placeholder) input.placeholder = field.placeholder;
        container.appendChild(label);
        container.appendChild(input);
      });
    }

    const createTipo = document.getElementById('create-tipo');
    const createFields = document.getElementById('create-fields');
    buildFields(createFields, createTipo.value);
    createTipo.addEventListener('change', () => buildFields(createFields, createTipo.value));

    const updateTipo = document.getElementById('update-tipo');
    const updateFields = document.getElementById('update-fields');
    buildFields(updateFields, updateTipo.value, 'u_');
    updateTipo.addEventListener('change', () => buildFields(updateFields, updateTipo.value, 'u_'));

    document.getElementById('btn-create').addEventListener('click', async () => {
      const tipo = document.getElementById('create-tipo').value;
      const data = { tipo };
      for (const f of schema[tipo]) {
        const el = document.getElementById(f.name);
        if (!el) continue;
        data[f.name] = f.type === 'number' ? Number(el.value) : el.value;
      }

      try {
        const res = await fetch(BASE_URL + '/productos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const json = await res.json();
        alert('Respuesta: ' + (res.ok ? 'producto creado' : 'error'));
        document.getElementById('get-result').textContent = JSON.stringify(json, null, 2);
      } catch (err) {
        console.error(err);
        alert('Error de conexión. Ver consola.');
      }
    });

    document.getElementById('btn-get').addEventListener('click', async () => {
      const id = document.getElementById('get-id').value.trim();
      const tipo = document.getElementById('get-tipo').value;
      if (!id) return alert('Ingrese un id');
      try {
        const res = await fetch(BASE_URL + '/productos/' + encodeURIComponent(id) + '?tipo=' + tipo, { method: 'GET' });
        const json = await res.json();
        document.getElementById('get-result').textContent = JSON.stringify(json, null, 2);
      } catch (err) {
        console.error(err);
        document.getElementById('get-result').textContent = 'Error de conexión';
      }
    });

    document.getElementById('btn-update').addEventListener('click', async () => {
      const id = document.getElementById('update-id').value.trim();
      const tipo = document.getElementById('update-tipo').value;
      if (!id) return alert('Ingrese un id');
      const data = { tipo };
      for (const f of schema[tipo]) {
        const el = document.getElementById('u_' + f.name);
        if (!el) continue;
        if (el.value !== '') data[f.name] = f.type === 'number' ? Number(el.value) : el.value;
      }
      try {
        const res = await fetch(BASE_URL + '/productos/' + encodeURIComponent(id), {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const json = await res.json();
        document.getElementById('update-result').textContent = JSON.stringify(json, null, 2);
      } catch (err) {
        console.error(err);
        document.getElementById('update-result').textContent = 'Error de conexión';
      }
    });

    document.getElementById('btn-delete').addEventListener('click', async () => {
      const id = document.getElementById('delete-id').value.trim();
      const tipo = document.getElementById('delete-tipo').value;
      if (!id) return alert('Ingrese un id');
      try {
        const res = await fetch(BASE_URL + '/productos/' + encodeURIComponent(id) + '?tipo=' + tipo, {
          method: 'DELETE'
        });
        const json = await res.json();
        document.getElementById('delete-result').textContent = JSON.stringify(json, null, 2);
      } catch (err) {
        console.error(err);
        document.getElementById('delete-result').textContent = 'Error de conexión';
      }
    });
  </script>
</body>
</html>
